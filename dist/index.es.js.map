{"version":3,"file":"index.es.js","sources":["../src/contextMenuItem.ts","../src/contextMenuOption.ts","../src/contextMenuDivider.ts","../src/helpers/selectNextFocusItem.ts","../src/contextMenuOptionGroup.ts","../src/contextMenu.ts"],"sourcesContent":["import { ContextMenu } from \"./contextMenu\";\n\nexport interface ContextMenuItemProps<TConfig> {\n    context: ContextMenu;\n    get config(): TConfig;\n    beforeExecute?(): void;\n}\n\nexport abstract class ContextMenuItem<TConfig> {\n    #context: ContextMenu;\n    get context(): ContextMenu { return this.#context; }\n\n    constructor(props: ContextMenuItemProps<TConfig>) {\n        this.#context = props.context;\n    }\n\n    abstract render(): HTMLElement;\n}\n\n\nexport type CustomContextMenuItem<TConfig> = (\n    typeof ContextMenuItem<TConfig> & (new (props: ContextMenuItemProps<TConfig>) => ContextMenuItem<TConfig>)\n);\n\n\nfunction createContextMenuItemInstance<\n    T extends ContextMenuItem<TConfig>,\n    TConfig\n>(\n    constructor: new (props: ContextMenuItemProps<TConfig>) => T,\n    props: ContextMenuItemProps<TConfig>\n): T {\n    return new constructor(props);\n}\n\nexport function initContextMenuItem<TConfig>(\n    constructor: new (props: ContextMenuItemProps<TConfig>) => ContextMenuItem<TConfig>,\n    props: ContextMenuItemProps<TConfig>\n): ContextMenuItem<TConfig> {\n    return createContextMenuItemInstance(constructor, props);\n}","import { IconElement } from \"@eythorsson-dev/common-utils\";\nimport { ContextMenuItem, ContextMenuItemProps } from \"./contextMenuItem\";\n\n\nexport interface ContextMenuOptionConfig {\n    get icon(): IconElement;\n    get type(): \"Option\";\n    get name(): string;\n\n    isDisabled?: boolean | (() => boolean);\n\n    execute(): void;\n}\n\nfunction getValue(item: boolean | (() => boolean)) {\n    if (typeof item === 'boolean') return item;\n    else if (typeof item === 'function') return item();\n\n    return false;\n}\n\nexport class ContextMenuOption extends ContextMenuItem<ContextMenuOptionConfig> {\n    #config: ContextMenuOptionConfig;\n\n    #beforeExecute: (() => void) | undefined;\n\n    constructor(props: ContextMenuItemProps<ContextMenuOptionConfig>) {\n        super(props);\n\n        this.#config = props.config;\n        this.#beforeExecute = props.beforeExecute;\n    }\n\n    render(): HTMLElement {\n        const wrapper = document.createElement(\"div\");\n        wrapper.className = \"context-menu-item\";\n        wrapper.tabIndex = 0;\n\n        const icon = document.createElement(\"div\");\n        icon.className = \"icon\";\n\n        if (this.#config.icon)\n            icon.append(this.#config.icon);\n\n        const name = document.createElement(\"div\");\n        name.className = \"title\";\n        name.innerText = this.#config.name;\n\n        wrapper.append(\n            icon,\n            name\n        );\n\n        if (getValue(this.#config.isDisabled ?? false)) {\n            wrapper.classList.add(\"disabled\");\n        }\n        else {\n            wrapper.addEventListener(\"keydown\", event => event.key == \"Enter\" && this.execute());\n            wrapper.addEventListener(\"click\", event => {\n                event.stopPropagation();\n                this.execute()\n            });\n        }\n\n        return wrapper;\n    }\n\n    execute() {\n        this.context.hide();\n        this.#beforeExecute?.();\n        this.#config.execute();\n    }\n}\n","import { ContextMenuItem, ContextMenuItemProps } from \"./contextMenuItem\";\n\nexport interface ContextMenuDividerConfig {\n    name?: string;\n    get type(): \"Divider\";\n}\nexport class ContextMenuDivider extends ContextMenuItem<ContextMenuDividerConfig> {\n\n    constructor(config: ContextMenuItemProps<ContextMenuDividerConfig>) {\n        super(config);\n    }\n\n    render(): HTMLElement {\n        const divider = document.createElement(\"hr\");\n        divider.className = \"context-menu-divider\";\n\n        return divider;\n    }\n}","\nexport function selectNextFocusItem(container: HTMLElement, activeElement: HTMLElement, selectNext: boolean) {\n    const focusableElements = [\n        ...container.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex=\"-1\"])')\n    ].reduce((arr, curr) => (arr.some(x => x.contains(curr)) || arr.push(curr as HTMLElement), arr), [] as HTMLElement[]);\n\n    const currentIndex = focusableElements.indexOf(activeElement);\n\n    const nextIndex = selectNext\n        ? (currentIndex + 1) % focusableElements.length\n        : (currentIndex - 1 + focusableElements.length) % focusableElements.length;\n\n    focusableElements[nextIndex].focus();\n}\n","import { IconElement, getIcon } from \"@eythorsson-dev/common-utils\";\nimport { ContextMenuItem, ContextMenuItemProps } from \"./contextMenuItem\";\nimport { ContextMenuDividerConfig } from \"./contextMenuDivider\";\nimport { ContextMenuOptionConfig } from \"./contextMenuOption\";\nimport { selectNextFocusItem } from \"./helpers/selectNextFocusItem\";\n\nexport type ContextMenuConfigs = ContextMenuOptionConfig | ContextMenuDividerConfig | ContextMenuOptionGroupConfig\n\nexport interface ContextMenuOptionGroupConfig {\n    get icon(): IconElement;\n    get type(): \"Group\";\n    get name(): string;\n\n    get items(): ContextMenuConfigs[]\n}\n\nexport class ContextMenuOptionGroup extends ContextMenuItem<ContextMenuOptionGroupConfig> {\n    #config: ContextMenuOptionGroupConfig;\n\n\n    constructor(props: ContextMenuItemProps<ContextMenuOptionGroupConfig>) {\n        super(props);\n\n        this.#config = props.config;\n    }\n\n    render(): HTMLElement {\n        const wrapper = document.createElement(\"div\");\n        wrapper.className = \"context-menu-item\";\n        wrapper.tabIndex = 0;\n\n        const icon = document.createElement(\"div\");\n        icon.className = \"icon\";\n        \n        if (this.#config.icon)\n            icon.append(this.#config.icon);\n\n        const name = document.createElement(\"div\");\n        name.className = \"title\";\n        name.innerText = this.#config.name;\n\n        const arrow = document.createElement(\"div\");\n        arrow.className = \"icon caret\";\n        arrow.append(getIcon(\"arrow-chevron-right\"));\n\n        wrapper.append(\n            icon,\n            name,\n            arrow\n        );\n\n        const subMenu = this.context.createMenu(this.#config.items);\n        wrapper.append(subMenu);\n\n        wrapper\n            .addEventListener(\"focus\", () => {\n                let _alignBottom = alignBottom();\n                let _alignLeft = alignLeft();\n\n                subMenu.style.setProperty(_alignBottom ? \"bottom\" : \"top\", \"0\");\n                subMenu.style.removeProperty(_alignBottom ? \"top\" : \"bottom\");\n                subMenu.style.setProperty(_alignLeft ? \"right\" : \"left\", \"100%\");\n                subMenu.style.removeProperty(_alignLeft ? \"left\" : \"right\");\n            })\n\n        wrapper\n            .addEventListener(\"keydown\", event => {\n                const _alignLeft = alignLeft();\n\n                // focus on first child\n                if (event.key == \"ArrowLeft\" && _alignLeft\n                    || event.key == \"ArrowRight\" && _alignLeft == false) {\n\n                    selectNextFocusItem(subMenu, subMenu, true);\n                }\n                // focus on parent\n                else if (event.key == \"ArrowLeft\" && _alignLeft == false\n                    || event.key == \"ArrowRight\" && _alignLeft) {\n\n                    wrapper.focus();\n                }\n\n            })\n        return wrapper;\n\n        function alignBottom() {\n            const subMenuRect = subMenu.getBoundingClientRect();\n            const parentRect = wrapper.getBoundingClientRect();\n\n            const mTop = parentRect.bottom - subMenuRect.height;\n            const mBottom = window.innerHeight - parentRect.top - subMenuRect.height;\n\n            let alignBottom = mTop >= 0 && mBottom < 0;\n            return alignBottom;\n        }\n\n        function alignLeft() {\n            const subMenuRect = subMenu.getBoundingClientRect();\n            const parentRect = wrapper.getBoundingClientRect();\n\n            const mLeft = parentRect.left - subMenuRect.width;\n            const mRight = window.innerWidth - parentRect.right - subMenuRect.width;\n\n            let alignLeft = mLeft >= 0 && mRight < 0;\n            return alignLeft;\n        }\n    }\n}\n","import { popupPosition, popupContainer } from \"@eythorsson-dev/common-utils\"\nimport { CustomContextMenuItem, initContextMenuItem } from \"./contextMenuItem\";\nimport { ContextMenuOption } from \"./contextMenuOption\";\nimport { ContextMenuDivider } from \"./contextMenuDivider\";\nimport { ContextMenuConfigs, ContextMenuOptionGroup } from \"./contextMenuOptionGroup\";\nimport { selectNextFocusItem } from \"./helpers/selectNextFocusItem\";\n\nexport interface ContextMenuConfig {\n    target: HTMLElement,\n    options: (ContextMenuConfigs[] | (() => ContextMenuConfigs[])),\n    itemByType?: { [key: string]: CustomContextMenuItem<any> },\n    beforeExecute?(): void,\n}\n\nfunction getOptionsValue(options: (ContextMenuConfigs[] | (() => ContextMenuConfigs[]))): ContextMenuConfigs[] {\n    if (typeof (options) == \"function\") return options();\n    else return options;\n}\n\nexport class ContextMenu {\n    #config: ContextMenuConfig;\n\n    constructor(config: ContextMenuConfig) {\n        this.#config = {\n            ...config,\n            itemByType: {\n                \"Option\": ContextMenuOption,\n                \"Divider\": ContextMenuDivider,\n                \"Group\": ContextMenuOptionGroup,\n                ...config.itemByType\n            }\n        };\n\n        config.target\n            .addEventListener(\"contextmenu\", event => {\n                event.preventDefault();\n                event.stopPropagation();\n\n                this.show(event.pageX, event.pageY)\n            });\n    }\n\n    #container: HTMLElement | undefined\n    show(x: number, y: number): void {\n        this.#container = this.createMenu(getOptionsValue(this.#config.options));\n        const popup = popupPosition(this.#container, x, y, { closeOnEsc: true, backsplachClassName: \"outline-none\" });\n        popup.backsplash?.focus();\n\n        // TODO: using context menu should reopen the context menu...\n        popup.backsplash?.addEventListener(\"contextmenu\", event => {\n            event.preventDefault();\n            popup.element.remove();\n        })\n    }\n\n    hide(): void {\n        this.#container?.remove();\n    }\n\n    createMenu(config: ContextMenuConfigs[]): HTMLElement {\n        const items = config.map(x => initContextMenuItem(\n            this.#config.itemByType![x.type],\n            {\n                context: this,\n                config: x,\n                beforeExecute: this.#config.beforeExecute\n            }\n        ));\n\n        const container = popupContainer(items.map(x => x.render()), \"context-menu\");\n\n        document.addEventListener(\"keydown\", event => onKeydown(event))\n        container.addEventListener(\"keydown\", event => onKeydown(event))\n\n        return container;\n\n        function onKeydown(event: KeyboardEvent) {\n            if (event.key == \"ArrowDown\" || event.key == \"ArrowUp\") {\n                const selectNext = event.key == \"ArrowDown\";\n\n                const activeElement = document.activeElement as HTMLElement;\n                selectNextFocusItem(container, activeElement, selectNext);\n                event.stopPropagation();\n            }\n        }\n    }\n}\n\n\n"],"names":["ContextMenuItem","props","__privateAdd","_context","__privateSet","__privateGet","createContextMenuItemInstance","constructor","initContextMenuItem","getValue","item","ContextMenuOption","_config","_beforeExecute","wrapper","icon","name","event","_a","ContextMenuDivider","config","divider","selectNextFocusItem","container","activeElement","selectNext","focusableElements","arr","curr","x","currentIndex","nextIndex","ContextMenuOptionGroup","arrow","getIcon","subMenu","_alignBottom","alignBottom","_alignLeft","alignLeft","subMenuRect","parentRect","mTop","mBottom","mLeft","mRight","getOptionsValue","options","ContextMenu","_container","y","popup","popupPosition","_b","items","popupContainer","onKeydown"],"mappings":"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"}